# TODO

- [ ] decide what to do about "floor"
  - [ ] if I keep it, make it work like sim tower (undeletable)
  - [ ] at the very least, make other rooms be able to be placed on top of it
- [ ] multiple textures for room (i.e fast food, variants of hotel room layout, etc)
  - [ ] chosen randomly (or in sequence) like in sim tower?
- [ ] first pass at room images
  - [x] split up render.rs into submodules
  - [ ] room texture should be overlaid with valid/invalid color in blueprint mode
  - [ ] BUG: transportation items should be drawn on top of everything else
- [ ] investigate turning Element into a trait again
  - to help with the state issue
- [ ] move camera around with middle click
- [ ] nicer sky colors
- [ ] fix annoying text line-height issue
  - [ ] maybe text.get_center could help
- [ ] get rid of the 'text' element field - just use a TextElementContentRenderer field/param!
- [ ] notifications system/ui
- [ ] weather
- [ ] additions to time panel:
  - [ ] day of the week (weekday/weekend)
  - [ ] season
- [ ] FPS counter
- [x] BUG: images (time speed button icons) are blurry on my HD monitor
- [x] ImageElementContentRenderer
  - [x] add to time speed buttons
- [ ] default element to NOOP content renderer - make a 'text' element factory that uses text content renderer
- [x] default panel element (like for button)
- [x] make Resizability::Fixed accept a u32 instead of Dimensions (since element.resizability is wrapped in a TwoDimensional now, it doesn't make sense)
- [x] a 'line height text wrapper' that centers text inside of it
  - [x] use in generic button element
- [ ] timer system is a little confusing
  - [ ] make TimerIds/TimerListenerIds Uuids instead of enums
  - [ ] the 'global tick' timer should be initizlied in the timers slice - right now it is initialized in the Time slice instead
- [ ] elements calculation is very confusing
- [x] add time speeds - pause, normal, fast, very fast
- [ ] consolidate where ElementActikons get run - it happens in 2 places right now
- [x] run `cargo fix --bin "towerbuilder-rs"`
- [x] merge "ElementAction" and "ElementUpdateAction" systems - they do the same thing
- [x] ElementHandle should be a &'static str, not enum
- [ ] UI element borders (configurable)
  - [ ] config options: thickness, color, inset (distance from outside)
    - [ ] inset will need to be calculated into overall element dimensions
- [ ] BUG: Resizability::ExpandToFill doesn't have a min_width
  - [ ] REFACTOR: refactor ui system to have element min-width's and max-widths? it might simplify things
- [ ] make Element.padding TwoDimensional
- [x] BUG: get rid of random "None" text in tools panel
- [x] rename 'prerender' to 'calculate' in elements mod
- [x] Make resizability TwoDimensional
- [ ] replace get_text_settings with get_theme instead
- [x] split time out into its own panel
  - [x] make clock with custom renderer
- [ ] Update tools panel button colors
- [ ] icons for tools panel buttons
- [ ] camera zooming
- [ ] experiment with different room sizes/dimensions
- [x] 'render content' for Elements -
  - doesn't need to have state or anything since it will just call macroquad render fns
  - [x] use for 'text'
  - [x] use it for clock in time panel
  - [ ] use also for minimap ultimately
- [ ] sfx
  - [ ] on build
  - [ ] on destroy
  - [ ] configurable volume
- [ ] simtower-style minimap with screen area outlined
  - [ ] map bounds - right now you can go as much as you want in any direction
- [ ] 'ElementState' - 1 each for active, hover, default, & has background_color, border_color, text_color, etc
- [x] sky that changes color with time of day
  - [x] try RGB lerping instead of HSL ? hsl lerping is does not look right to me
  - [ ] overlay that darkens tower and stuff too
  - [ ] use a shader for the sky instead of just rectangle
- [x] BUG: more than 1 set of room definitions button can get added
- [ ] floating money UI element when player builds
- [ ] recalculate UI when screen size changes
- [x] selected room definition button too
- [x] change previous_selected_cell & current_selected_cell to PrevAndCurrent<Coordinates>
- [ ] selected cell still doesn't appear underneath cursor correctly
- [ ] destroy tool
  - [x] basic destroying a room
  - [ ] destroy validation
  - [ ] cursor showing where the deletion will happen
    - [x] highlight current selected cell
    - [ ] hightlight room hovered over
- [ ] default button element other buttons can inherit from
- [ ] line height is messed up in tool buttons because I think i'm using std::cmp::min(height, DEFAULT_FONT_SIZE) in that one place
- [ ] give element.interactivity is_hovered and is_clicked PrevAndNexts to match is_active
- [x] "active"/"selected" buttons - selected tool button, selected roomd definition
- [ ] multiple tools - normal, build, destroy
- [ ] screens (start screen, etc)
- [x] factories/components could just be components/
- [ ] put calculated prerendered stuff in a different place to Element?
- [x] empty string = element of zero height
- [ ] cache prerendering (right now it's done every frame)
- [ ] updating text should flip a "needs recalculation" flag
- [x] put game.ui.selection into game.tools
- [x] removing ui elements + children by name or id
  - [x] or 'handle'? enum
- [ ] use default padding + child gap everywhere
- [x] an 'update' callback callback for ui elements
- [ ] "layers" - i.e a stack of root nodes instead of just 1
  - [ ] higher layer = rendered on top & responds to click first
  - [ ] attempt this again with a different strategy - nodes have 'types': 'Default' or 'Layer'. Layer acts as a layer and has the same dimensions as its parent
- [ ] resizability should be configurable on a per-axis basis (right now it's for both)
- [x] interactive layout_nodes
  - [x] hover states
  - [x] click state
  - [x] button 'actions' described by enum - e.g "SelectRoomDefinition(id: string)", "RemoveUIElement(id: string)", "AddUIElement(some other enum)"
- [x] remove nodes
- [x] stretch to fill layout_nodes
  - [x] take primary/off axis into account (e.g off axis will not have siblings)
  - [x] support multiple stretch to fill siblings
  - [x] recurse down as well (or does it already do this?)
- [x] Fix the ordering of the input/ui update/interactivity/prerendering, it is not obvious and hard to follow right now
- [ ] middleware-like prerender/precalculate "modifiers" to override prerendered values in a clean/abstracted way (like randomizing background/text colors)
- [ ] "validate layout" or something, that identifies/warns when children_size is greater than content_size etc
- [x] rename 'prerender' to 'precalculate'
- [x] rename 'element_tree' to 'elements'
- [ ] update algorithms to calculate widths of all children at once
- [ ] abstract layout calculations from actual layout node system - it's just a bunch of math
  - [ ] basic tests
- [ ] adding/removing a layout node should trigger a rerender
  - make Elements.tree private? this would be the only way to really ensure this happens
- [ ] I could probably iterate through things once instead of twice, once for each axis
- [ ] text color config
- [ ] UI theme
- [ ] "space between" gap style
  - child_gap will need to be an enum, "Fixed" and "SpaceBetween"
  - actually this sounds a lot like expand_to_fill with all nodes having a weight of 1
- [ ] UI components
  - [ ] buttons
    - (This will probably be the done when I do the "interactive layout_nodes" thing ^^^)
  - [ ] text inputs
  - [ ] radios

## Cleanup

- [ ] move measurements mod into types mod

## Route finding

## Other

- translate pixel ratio better? (things look small on my monitor)
- keycode=>command mapping system
- room/cursor position is still wrong.
- 'active' state for buttons
- info text when you hover over room buttons
- flexible Dimensions for buttons
- UI themes
- different colors of sky for different times of day
- different color grading/shading for different times of day
- water pipes
- electricity
- bathrooms
- heatmaps
- car parking (above and below ground)
  - some office occupants need it and others dont
- monorail (2nd + floors)
- underground rail
- rename 'tower' to 'current_tower'
- status text goes away after timer
- status text should have a max width and wrap lines
- notification text when you get office income
- if no transportation is connected to room, complain via notification and tenants should not move in/existing tenants should move out
- Floor room type, that
  - is placeable like a normal room
  - connects rooms on the same floor when they arent placed next to each other
  - replaces a room when it is deleted
- destroyable rooms
- basic saving/loading UI
- tests that use fixture data
  - e.g for route-finding algorithm
  - derive Debug on Game & print out game -> copy + paste to create fixture data. Not json data
- 'resizable after placement' resizable rooms (elevators, but maybe lobby??)
- restaurants
- Different colors for whether a room is occupied or not
- Randomization within range for moving in/checking in/out, so it doesn't all happen at once
- colors for night/day
- weather
- Room evaluation
  - affected by proximity to elevators, noisy room types, etc
  - improvements over time
- fix this tower.tower pattern with TowerSlice
- line-height for text
- Query builder type for rooms in tower
- Room will probably need to be a trait to enable custom behavior/data for specific room types
- room selection Buttons
- Tools
  - build, destroy, inspect
- build tool panel
- room destroying
  - seperate build/destroy validation
- Room "layers" (just basic + transportation, for now)
- Tools
- Camera point offset to enable lerping between cells + smooth scanning
- Basic SFX
- Esc menu
- Store rooms by floor as well, for performance reasons
  - I might have to start using Rc+RefCell for this
  - Don't do this until it makes sense to start optimizing

# Done

- layout node system
  - get rid of Elements and make TreeNodes store a generic Data type
  - rename 'layout\*tree' to 'elements' or 'ui_elements'
  - create 'LayoutNode\_\_?' struct to encapsulate layout node list/tree stuff, but not coupled to slice
  - slice could just be a thin wrapper around this
  - account for 'flow direction' when calculating position on axis
  - 'calculate' layout node functions maybe shouldn't live on layout\_)node
    - create new calculated dimensions property: children_dimensions. Total children size is not going to always be the same as content_size
  - center content on non primary axis too
- add 'color' to calculated layout node properties for now to stop the crazy flashing
- button 'row's
- abstract button row's dimensions/positioning into a 1D fn.
- after I get layout node working, refactor Wrapper/LeafNode to just be the same type
- Clickable buttons (ui state)
- deprecate stuff called "\_\_Slice"
- seperate game into 'world' and 'ui'
  - world = time, towers, wallet
  - engine = "timers"
  - ui
- rooms should not get occupants unless they are connected to transportation
- timer ids should be enums not strings
- Timers + listeners should use enums instead of strings for ids
- Transportation, pathfinding
- json serialization/deserialization
- Room 'layers'
  - normal
  - transportation
- BUGFIX: room blueprint 'offset' doesn't get calculated when placing
- Occupants
  - arrive between 5-8 in the evening, leave 7-10 in the morning
- center blueprint room to cursor
- Flexible rooms price should be per cell
- Time
- Occupants
  - that move into condo
  - that move into office
- Office rent money
- Condo sale money
- Room colors
- Don't reset the selected cell to 0,0 every time
- Resizable rooms
- Make blueprint room centered on cursor, not below/to the right
- Orient 0,0 to the middle of the screen (not top left)
- Floor gfx
- Basic Camera
- base set of validators for all room definitions
